{% extends "base.html" %}

{% block title %}{{ exercise_name }} - An√°lisis en Vivo - BioTrack{% endblock %}

{% block content %}
<div class="live-analysis-container fade-in">
    <!-- üéØ INDICADOR DE TIPO DE AN√ÅLISIS (Sujeto vs Auto-an√°lisis) -->
    {% if analysis_subject_id %}
    <div class="analysis-target-banner subject-analysis">
        <div class="banner-content">
            <i class="bi bi-person-check-fill me-2"></i>
            <span>Analizando a: <strong>{{ analysis_subject_name }}</strong></span>
            <span class="badge bg-info ms-2">An√°lisis de Sujeto</span>
            <a href="{{ url_for('main.subjects_view', subject_id=analysis_subject_id) }}" 
               class="btn btn-sm btn-outline-light ms-3" title="Ver perfil del sujeto">
                <i class="bi bi-eye"></i> Ver Sujeto
            </a>
            <a href="{{ url_for('main.segments') }}" 
               class="btn btn-sm btn-outline-warning ms-2" title="Cambiar a auto-an√°lisis">
                <i class="bi bi-x-circle"></i> Cancelar
            </a>
        </div>
    </div>
    {% else %}
    <div class="analysis-target-banner self-analysis">
        <div class="banner-content">
            <i class="bi bi-person-fill me-2"></i>
            <span><strong>Auto-an√°lisis</strong> - Los resultados se guardar√°n en tu historial personal</span>
            <span class="badge bg-success ms-2">Mi An√°lisis</span>
        </div>
    </div>
    {% endif %}

    <!-- üìä SECCI√ìN PRINCIPAL: VIDEO + DATOS EN TIEMPO REAL (lado a lado) -->
    <div class="main-analysis-row">
        <!-- üé• COLUMNA DE VIDEO -->
        <div class="video-column">
            <!-- Header del ejercicio con dropdown de navegaci√≥n -->
            <div class="exercise-header-bar">
                <div class="header-content">
                    <div class="header-title">
                        <!-- Dropdown de ejercicios -->
                        <div class="exercise-dropdown-container">
                            <button class="exercise-dropdown-btn" onclick="toggleExerciseDropdown()" id="exerciseDropdownBtn">
                                <i class="bi bi-camera-video-fill me-2"></i>
                                <span>{{ exercise_name }}</span>
                                <i class="bi bi-chevron-down ms-2 dropdown-arrow"></i>
                            </button>
                            
                            <!-- Men√∫ dropdown -->
                            <div class="exercise-dropdown-menu" id="exerciseDropdownMenu">
                                {% for segment in all_exercises_menu %}
                                <div class="dropdown-segment">
                                    <div class="dropdown-segment-title">
                                        <i class="bi bi-diagram-3"></i> {{ segment.name }}
                                    </div>
                                    {% for ex in segment.exercises %}
                                    <a href="#" 
                                       class="dropdown-exercise-item {% if ex.is_current %}current{% endif %}"
                                       onclick="changeExercise('{{ segment.key }}', '{{ ex.key }}'); return false;"
                                       {% if ex.is_current %}aria-current="true"{% endif %}>
                                        <span class="exercise-item-name">{{ ex.name }}</span>
                                        <span class="exercise-item-view">{{ ex.view }}</span>
                                        {% if ex.is_current %}<i class="bi bi-check-lg current-check"></i>{% endif %}
                                    </a>
                                    {% endfor %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <small class="header-description">{{ exercise_description }}</small>
                    </div>
                    <div class="view-badge">
                        <i class="bi bi-eye-fill me-1"></i>
                        Vista: <strong>{{ camera_view_label }}</strong>
                    </div>
                </div>
            </div>

            <!-- Video Feed -->
            <div class="video-section">
                <div class="video-wrapper" id="videoWrapper">
                    <img id="videoFeed" 
                         src="{{ url_for('api.video_feed', camera=camera_index) }}" 
                         alt="Video en vivo"
                         class="video-stream"
                         data-camera-index="{{ camera_index }}"
                         data-subject-id="{{ analysis_subject_id or '' }}"
                         data-subject-name="{{ analysis_subject_name or '' }}">
                    
                    <!-- Overlay de carga -->
                    <div id="loadingOverlay" class="video-overlay loading">
                        <div class="spinner-border text-light mb-3" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <h5>Inicializando c√°mara...</h5>
                        <p id="loadingText" class="text-muted small">Esto puede tomar unos segundos</p>
                    </div>
                </div>
            </div>

            <!-- Controles de video -->
            <div class="video-controls">
                <button id="startBtn" class="btn btn-success" onclick="startAnalysis()" 
                        title="Resetea ROM y marca el inicio de la sesi√≥n oficial">
                    <i class="bi bi-play-fill"></i> Iniciar
                </button>
                <button id="stopBtn" class="btn btn-danger" onclick="stopAnalysis()" disabled>
                    <i class="bi bi-stop-fill"></i> Detener
                </button>
                <button id="resetBtn" class="btn btn-warning" onclick="resetROM()">
                    <i class="bi bi-arrow-clockwise"></i> Reset ROM
                </button>
                <button id="audioBtn" class="btn btn-info" onclick="toggleAudio()" title="Activar/Desactivar gu√≠a de voz">
                    <i class="bi bi-volume-up-fill" id="audioIcon"></i> Audio
                </button>
                <button id="fullscreenBtn" class="btn btn-info" onclick="toggleFullscreen()">
                    <i class="bi bi-arrows-fullscreen"></i> Pantalla Completa
                </button>
                <button id="configBtn" class="btn btn-secondary" onclick="openCameraConfig()" 
                        title="Configurar c√°mara, resoluci√≥n y calidad">
                    <i class="bi bi-gear"></i> Configuraci√≥n
                </button>
                <button onclick="navigateBack()" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Volver
                </button>
            </div>
        </div>

        <!-- üìä PANEL LATERAL: SOLO DATOS EN TIEMPO REAL -->
        <div class="realtime-panel">
            <div class="info-card">
                <div class="info-card-header">
                    <i class="bi bi-graph-up"></i>
                    <span>Datos en Tiempo Real</span>
                </div>
                
                <div class="metrics-grid">
                    <!-- √Ångulo Actual -->
                    <div class="metric-box primary">
                        <div class="metric-label">√ÅNGULO ACTUAL</div>
                        <div class="metric-value" id="currentAngle">0¬∞</div>
                        <div class="metric-side" id="currentSide"></div>
                    </div>
                    
                    <!-- ROM M√°ximo -->
                    <div class="metric-box success">
                        <div class="metric-label">ROM M√ÅXIMO</div>
                        <div class="metric-value" id="maxROM">0¬∞</div>
                    </div>
                    
                    <!-- Estado de Postura -->
                    <div class="metric-box wide info-status">
                        <div class="metric-label">ESTADO DE POSTURA</div>
                        <div class="metric-status" id="postureStatus">
                            <i class="bi bi-hourglass-split"></i>
                            <span>Detectando...</span>
                        </div>
                    </div>
                    
                    <!-- FPS -->
                    <div class="metric-box secondary">
                        <div class="metric-label">FPS</div>
                        <div class="metric-value small" id="fpsDisplay">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- üìã SECCI√ìN SECUNDARIA: GR√ÅFICO, RANGOS E INSTRUCCIONES (debajo) -->
    <div class="secondary-info-row">
        <!-- Card: Gr√°fico de Progreso ROM -->
        <div class="info-card">
            <div class="info-card-header">
                <i class="bi bi-bar-chart-line"></i>
                <span>Progreso ROM</span>
            </div>
            <div class="rom-chart-container">
                <canvas id="romChart"></canvas>
            </div>
        </div>

        <!-- Card: Clasificaci√≥n ROM (con bibliograf√≠a) -->
        <div class="info-card rom-classification-card">
            <div class="info-card-header">
                <i class="bi bi-clipboard2-pulse"></i>
                <span>Clasificaci√≥n ROM</span>
            </div>
            
            {% if rom_info %}
            <!-- Rango Normal -->
            <div class="rom-normal-range">
                <div class="range-header">
                    <i class="bi bi-rulers"></i>
                    <span>Rango Normal: <strong>{{ rom_info.normal_range.min }}¬∞ - {{ rom_info.normal_range.max }}¬∞</strong></span>
                </div>
            </div>
            
            <!-- Escala de Clasificaci√≥n -->
            <div class="classification-scale">
                {% for level, data in rom_info.classification.items() %}
                <div class="classification-item" style="border-left: 4px solid {{ data.color }};">
                    <div class="classification-level" style="color: {{ data.color }};">
                        {{ level|replace('_', ' ')|title }}
                    </div>
                    <div class="classification-range">
                        {{ data.min }}¬∞ - {{ data.max }}¬∞ <span class="percentage">({{ data.percentage }})</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- Fallback si no hay rom_info -->
            <ul class="range-list">
                <li>
                    <span class="range-label">M√≠nimo esperado:</span>
                    <span class="range-value">{{ min_angle }}¬∞</span>
                </li>
                <li>
                    <span class="range-label">M√°ximo esperado:</span>
                    <span class="range-value">{{ max_angle }}¬∞</span>
                </li>
            </ul>
            {% endif %}
        </div>

        <!-- Card: Historial Reciente -->
        <div class="info-card" id="recentHistoryPanel">
            <div class="info-card-header">
                <i class="bi bi-clock-history"></i>
                {% if analysis_subject_id %}
                    <span>Historial de {{ analysis_subject_name.split(' ')[0] if analysis_subject_name else 'Sujeto' }}</span>
                {% else %}
                    <span>Tu Historial</span>
                {% endif %}
            </div>
            <div class="history-list" style="flex: 1; overflow-y: auto; padding: 8px;">
                <!-- Se llena din√°micamente con JavaScript -->
                <div class="text-center text-muted py-3" id="historyLoading">
                    <i class="bi bi-hourglass-split"></i>
                    <small>Cargando historial...</small>
                </div>
                <div id="historyEmpty" class="text-center text-muted py-3" style="display: none;">
                    <i class="bi bi-inbox"></i>
                    <small>No hay an√°lisis previos para este ejercicio</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ‚öôÔ∏è MODAL DE CONFIGURACI√ìN DE C√ÅMARA -->
<div id="cameraConfigModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title">
                    <i class="bi bi-gear-fill me-2"></i>
                    Configuraci√≥n de C√°mara
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- üåê SELECTOR DE MODO (LocalHost vs VPS) -->
                <div class="card mb-4 border-primary">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-cloud-check me-2"></i>
                        <strong>Modo de Operaci√≥n</strong>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-6">
                                <button type="button" class="btn btn-outline-info w-100 py-3 mode-btn" 
                                        id="btnModeLocalhost" onclick="setCameraMode('localhost')">
                                    <i class="bi bi-pc-display fs-3 d-block mb-2"></i>
                                    <strong>Modo LocalHost</strong>
                                    <small class="d-block text-muted">C√°mara del servidor</small>
                                </button>
                            </div>
                            <div class="col-6">
                                <button type="button" class="btn btn-outline-success w-100 py-3 mode-btn" 
                                        id="btnModeVps" onclick="setCameraMode('vps')">
                                    <i class="bi bi-cloud fs-3 d-block mb-2"></i>
                                    <strong>Modo VPS</strong>
                                    <small class="d-block text-muted">C√°mara del navegador</small>
                                </button>
                            </div>
                        </div>
                        <div class="alert alert-info mt-3 mb-0" id="modeDescription">
                            <i class="bi bi-info-circle me-2"></i>
                            <span id="modeDescriptionText">Selecciona el modo seg√∫n tu entorno</span>
                        </div>
                    </div>
                </div>
                
                <!-- Alerta de sesi√≥n activa -->
                <div id="configSessionWarning" class="alert alert-warning d-none">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Sesi√≥n activa:</strong> Solo se puede cambiar la calidad JPEG. 
                    Para cambiar c√°mara o resoluci√≥n, det√©n la sesi√≥n primero.
                </div>
                
                <!-- Selector de C√°mara -->
                <div class="mb-4" id="cameraSelectSection">
                    <label class="form-label fw-bold">
                        <i class="bi bi-camera-video me-1"></i> C√°mara
                    </label>
                    <select id="cameraSelect" class="form-select">
                        <option value="0">Cargando c√°maras...</option>
                    </select>
                    <small class="text-muted">Selecciona la c√°mara a utilizar</small>
                </div>
                
                <!-- Selector de Resoluci√≥n -->
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        <i class="bi bi-aspect-ratio me-1"></i> Resoluci√≥n
                    </label>
                    <select id="resolutionSelect" class="form-select">
                        <option value="640x480">480p (VPS) - Optimizado servidor</option>
                        <option value="854x480">480p (SD) - M√°s r√°pido</option>
                        <option value="960x540" selected>540p - Recomendado</option>
                        <option value="1280x720">720p (HD)</option>
                        <option value="1920x1080">1080p (Full HD) - M√°s lento</option>
                    </select>
                    <small class="text-muted">Mayor resoluci√≥n = mejor calidad pero m√°s lento</small>
                </div>
                
                <!-- Slider de Calidad JPEG -->
                <div class="mb-3">
                    <label class="form-label fw-bold">
                        <i class="bi bi-image me-1"></i> Calidad JPEG: <span id="jpegQualityValue">60</span>%
                    </label>
                    <input type="range" class="form-range" id="jpegQualitySlider" 
                           min="20" max="95" value="60" step="5">
                    <div class="d-flex justify-content-between text-muted small">
                        <span>R√°pido (baja calidad)</span>
                        <span>Lento (alta calidad)</span>
                    </div>
                </div>
                
                <!-- Info actual -->
                <div class="card bg-light mt-3">
                    <div class="card-body py-2">
                        <small class="text-muted">
                            <i class="bi bi-info-circle me-1"></i>
                            <span id="currentConfigInfo">Cargando configuraci√≥n...</span>
                        </small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="saveCameraConfig()">
                    <i class="bi bi-check-lg me-1"></i> Aplicar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- üéâ MODAL DE RESULTADOS -->
<div id="resultsModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content results-modal-content">
            <div class="modal-header results-modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-trophy-fill me-2"></i>
                    Resultados del An√°lisis
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body results-modal-body">
                <!-- ‚ö†Ô∏è ALERTA DE MEDICI√ìN SOSPECHOSA -->
                <div id="suspiciousAlert" class="alert alert-warning d-none mb-3" role="alert">
                    <div class="d-flex align-items-start">
                        <i class="bi bi-exclamation-triangle-fill fs-4 me-3 text-warning"></i>
                        <div>
                            <h6 class="alert-heading mb-1">
                                <strong>‚ö†Ô∏è Medici√≥n posiblemente incorrecta</strong>
                            </h6>
                            <p id="suspiciousReason" class="mb-2 small"></p>
                            <p id="suspiciousRecommendation" class="mb-1 small text-muted"></p>
                            <p id="suspiciousExpectedRange" class="mb-0 small"><em></em></p>
                        </div>
                    </div>
                </div>
                
                <div class="results-summary">
                    <div class="result-item">
                        <span class="result-label">Ejercicio:</span>
                        <span class="result-value">{{ exercise_name }}</span>
                    </div>
                    
                    <!-- ROM para an√°lisis unilateral (perfil) -->
                    <div id="unilateralResult" class="result-item highlight-item">
                        <span class="result-label">ROM M√°ximo Alcanzado:</span>
                        <span id="finalROM" class="result-value highlight">0¬∞</span>
                        <span id="finalSide" class="badge bg-info ms-2">---</span>
                    </div>
                    
                    <!-- ROM para an√°lisis bilateral (frontal) - oculto por defecto -->
                    <div id="bilateralResult" class="bilateral-results" style="display: none;">
                        <div class="result-item highlight-item">
                            <span class="result-label">ROM M√°ximo Izquierdo:</span>
                            <span id="leftROM" class="result-value highlight" style="color: #00d4ff;">0¬∞</span>
                            <span id="leftClassification" class="badge bg-secondary ms-2">-</span>
                        </div>
                        <div class="result-item highlight-item">
                            <span class="result-label">ROM M√°ximo Derecho:</span>
                            <span id="rightROM" class="result-value highlight" style="color: #ff00ff;">0¬∞</span>
                            <span id="rightClassification" class="badge bg-secondary ms-2">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Asimetr√≠a:</span>
                            <span id="asymmetryValue" class="result-value">0¬∞</span>
                            <span id="asymmetryBadge" class="badge bg-success ms-2">Normal</span>
                        </div>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Clasificaci√≥n:</span>
                        <span id="romClassification" class="result-value classification-badge">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Rango Esperado:</span>
                        <span class="result-value">{{ min_angle }}¬∞ - {{ max_angle }}¬∞</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer results-modal-footer">
                <button type="button" class="btn btn-success" onclick="saveResults()">
                    <i class="bi bi-save me-1"></i> Guardar en Historial
                </button>
                <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">
                    Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ü¶µ MODAL DE SELECCI√ìN DE PIERNA PARA HIP ABDUCTION -->
<div id="legSelectionModal" class="modal fade" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content leg-selection-modal-content">
            <div class="modal-header leg-selection-header">
                <h5 class="modal-title">
                    <i class="bi bi-arrow-left-right me-2"></i>
                    Selecci√≥n de Pierna
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar" onclick="cancelLegSelection()"></button>
            </div>
            <div class="modal-body leg-selection-body">
                <p class="mb-4 text-center" id="legSelectionMessage">
                    Para el an√°lisis de <strong>Abducci√≥n de Cadera</strong>, 
                    seleccione qu√© pierna desea analizar primero:
                </p>
                
                <div class="leg-buttons-container">
                    <button type="button" class="btn btn-leg btn-leg-left" onclick="selectLegAndStart('left')">
                        <i class="bi bi-arrow-left-circle fs-1 mb-2"></i>
                        <span class="leg-label">Pierna Izquierda</span>
                    </button>
                    <button type="button" class="btn btn-leg btn-leg-right" onclick="selectLegAndStart('right')">
                        <i class="bi bi-arrow-right-circle fs-1 mb-2"></i>
                        <span class="leg-label">Pierna Derecha</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- üîÑ MODAL DE CONTINUACI√ìN (segunda pierna) -->
<div id="continueAnalysisModal" class="modal fade" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content continue-modal-content">
            <div class="modal-header continue-modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-check-circle-fill me-2 text-success"></i>
                    Primera Pierna Completada
                </h5>
            </div>
            <div class="modal-body continue-modal-body">
                <div class="first-leg-result mb-4">
                    <p class="mb-2">Resultado de pierna <strong id="firstLegLabel">---</strong>:</p>
                    <div class="result-display">
                        <span id="firstLegROM" class="fs-2 fw-bold text-biomech-cyan">0¬∞</span>
                        <span id="firstLegClass" class="badge bg-success ms-2">-</span>
                    </div>
                </div>
                
                <p class="mb-3 text-center" id="continueMessage">
                    ¬øDesea continuar con la pierna <strong id="secondLegLabel">---</strong>?
                </p>
                
                <div class="d-flex justify-content-center gap-3">
                    <button type="button" class="btn btn-success btn-lg" onclick="continueWithSecondLeg()">
                        <i class="bi bi-arrow-right-circle me-2"></i>
                        Continuar
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="skipSecondLeg()">
                        Omitir
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block styles %}
<style>
/* ============================================================
   üéØ BANNER DE TIPO DE AN√ÅLISIS (Sujeto vs Auto-an√°lisis)
   ============================================================ */

.analysis-target-banner {
    padding: 12px 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.analysis-target-banner .banner-content {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 5px;
}


.analysis-target-banner.subject-analysis {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: white;
    border: 2px solid #0d6efd;
    box-shadow: 0 8px 32px rgba(13, 110, 253, 0.3);
    transition: box-shadow 0.3s, transform 0.3s;
}

.analysis-target-banner.subject-analysis:hover {
    box-shadow: 0 12px 40px rgba(13, 110, 253, 0.4);
    transform: translateY(-2px);
}

.analysis-target-banner .banner-content {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    padding: 8px 0;
}

.analysis-target-banner .btn-outline-light {
    color: #adb5bd;
    border-color: #495057;
    background: rgba(255,255,255,0.08);
    transition: background 0.2s, color 0.2s;
}

.analysis-target-banner .btn-outline-light:hover {
    background: #495057;
    color: #fff;
}

.analysis-target-banner .btn-outline-warning {
    color: #ffc107;
    border-color: #ffc107;
    background: rgba(255,193,7,0.08);
    transition: background 0.2s, color 0.2s;
}

.analysis-target-banner .btn-outline-warning:hover {
    background: #ffc107;
    color: #000;
}

.analysis-target-banner .btn-sm {
    font-size: 0.85rem;
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: 500;
    box-shadow: 0 2px 8px rgba(13,110,253,0.08);
}

.analysis-target-banner.self-analysis {
    background: linear-gradient(135deg, #198754 0%, #20c997 100%);
    color: white;
    border: 2px solid #146c43;
}

.analysis-target-banner i {
    font-size: 1.2rem;
}

.analysis-target-banner .btn-outline-light {
    border-color: rgba(255,255,255,0.5);
}

.analysis-target-banner .btn-outline-light:hover {
    background: rgba(255,255,255,0.2);
}

.analysis-target-banner .btn-outline-warning {
    color: #ffc107;
    border-color: #ffc107;
}

.analysis-target-banner .btn-outline-warning:hover {
    background: #ffc107;
    color: #000;
}

/* ============================================================
   üè∑Ô∏è BADGE PERSONALIZADO PARA CLASIFICACI√ìN "AUMENTADO"
   Color: Amarillo dorado - Indica hiperlaxitud articular
   ============================================================ */

.bg-increased {
    background-color: #F59E0B !important;  /* Amarillo dorado/√°mbar */
    color: #000 !important;                 /* Texto negro para contraste */
}

.badge.bg-increased {
    font-weight: 600;
}

/* ============================================================
   üé® LAYOUT PRINCIPAL - VIDEO + DATOS EN TIEMPO REAL
   Solo el panel de datos en tiempo real est√° al lado derecho
   ============================================================ */

.live-analysis-container {
    padding: 15px;
    max-width: 1600px;
    margin: 0 auto;
}

/* ============================================================
   üìä FILA PRINCIPAL: VIDEO + PANEL DE DATOS (lado a lado)
   ============================================================ */

.main-analysis-row {
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: 20px;
    align-items: stretch;
    margin-bottom: 20px;
}

/* ============================================================
   üé• COLUMNA DE VIDEO
   ============================================================ */

.video-column {
    min-width: 0;
    display: flex;
    flex-direction: column;
}

.exercise-header-bar {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 20px;
    border-radius: 12px 12px 0 0;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.header-title h4 {
    font-size: 1.25rem;
    font-weight: 600;
}

.header-description {
    opacity: 0.85;
    font-size: 0.85rem;
}

.view-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    white-space: nowrap;
}

/* ============================================================
   üîΩ DROPDOWN DE EJERCICIOS EN EL HEADER
   ============================================================ */

.exercise-dropdown-container {
    position: relative;
    display: inline-block;
}

.exercise-dropdown-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
    padding: 5px 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    border-radius: 8px;
    transition: background 0.2s ease;
}

.exercise-dropdown-btn:hover {
    background: rgba(255, 255, 255, 0.15);
}

.exercise-dropdown-btn .dropdown-arrow {
    font-size: 0.8rem;
    transition: transform 0.2s ease;
}

.exercise-dropdown-btn.open .dropdown-arrow {
    transform: rotate(180deg);
}

.exercise-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 320px;
    max-height: 450px;
    overflow-y: auto;
    background: rgba(30, 30, 50, 0.98);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    margin-top: 8px;
    backdrop-filter: blur(10px);
}

.exercise-dropdown-menu.show {
    display: block;
    animation: dropdownFadeIn 0.2s ease;
}

@keyframes dropdownFadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.dropdown-segment {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.dropdown-segment:last-child {
    border-bottom: none;
}

.dropdown-segment-title {
    padding: 12px 16px 8px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    color: #a0a0c0;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.dropdown-segment-title i {
    font-size: 0.9rem;
}

.dropdown-exercise-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px 10px 32px;
    color: #e0e0e0;
    text-decoration: none;
    transition: background 0.15s ease;
    cursor: pointer;
}

.dropdown-exercise-item:hover {
    background: rgba(102, 126, 234, 0.25);
    color: white;
}

.dropdown-exercise-item.current {
    background: rgba(102, 126, 234, 0.4);
    color: #a8c0ff;
    pointer-events: none;
}

.exercise-item-name {
    font-size: 0.9rem;
    flex: 1;
}

.exercise-item-view {
    font-size: 0.75rem;
    color: #888;
    background: rgba(255, 255, 255, 0.1);
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: 10px;
}

.current-check {
    color: #4ade80;
    font-size: 1rem;
    margin-left: 8px;
}

/* Scrollbar personalizado para el dropdown */
.exercise-dropdown-menu::-webkit-scrollbar {
    width: 6px;
}

.exercise-dropdown-menu::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

.exercise-dropdown-menu::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
}

.exercise-dropdown-menu::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
}

.video-section {
    background: #1a1a2e;
    position: relative;
    flex: 1;
}

.video-wrapper {
    position: relative;
    background: #000;
    aspect-ratio: 16 / 9;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.video-stream {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
}

.video-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.85);
    color: white;
    z-index: 10;
}

.video-overlay.hidden {
    display: none !important;
}

.video-controls {
    padding: 15px 20px;
    background: #16213e;
    border-radius: 0 0 12px 12px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}

.video-controls .btn {
    padding: 8px 16px;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

/* ============================================================
   üìä PANEL LATERAL - SOLO DATOS EN TIEMPO REAL
   ============================================================ */

.realtime-panel {
    display: flex;
    flex-direction: column;
}

.realtime-panel .info-card {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.realtime-panel .metrics-grid {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.realtime-panel .metric-box {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* ============================================================
   üìã SECCI√ìN SECUNDARIA - GR√ÅFICO, RANGOS, HISTORIAL
   ============================================================ */

.secondary-info-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 15px;
    align-items: start;
}

/* ============================================================
   üé¥ INFO CARDS
   ============================================================ */

.info-card {
    background: #1a1a2e;
    border-radius: 12px;
    padding: 12px 14px;
    border: 1px solid rgba(102, 126, 234, 0.2);
}

.info-card-header {
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 10px;
    color: #e0e0e0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.info-card-header i:first-child {
    color: #667eea;
    font-size: 1rem;
}

.info-card-header.clickable {
    cursor: pointer;
    transition: color 0.2s;
}

.info-card-header.clickable:hover {
    color: #667eea;
}

.collapse-icon {
    transition: transform 0.3s;
}

.info-card-header[aria-expanded="true"] .collapse-icon {
    transform: rotate(180deg);
}

/* ============================================================
   üìä M√âTRICAS
   ============================================================ */

.metrics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.metric-box {
    text-align: center;
    padding: 14px 10px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.03);
    transition: transform 0.2s, box-shadow 0.2s;
}

.metric-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.metric-box.primary {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
    border: 1px solid rgba(102, 126, 234, 0.5);
}

.metric-box.success {
    background: linear-gradient(135deg, rgba(17, 153, 142, 0.15) 0%, rgba(56, 239, 125, 0.15) 100%);
    border: 1px solid rgba(17, 153, 142, 0.5);
}

.metric-box.wide {
    grid-column: 1 / -1;
}

.metric-box.info-status {
    background: rgba(33, 150, 243, 0.1);
    border: 1px solid rgba(33, 150, 243, 0.4);
}

.metric-box.secondary {
    grid-column: 1 / -1;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.metric-label {
    font-size: 0.7rem;
    color: #999;
    margin-bottom: 6px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.metric-value {
    font-size: 2rem;
    font-weight: 700;
    color: #00d4ff;
    line-height: 1;
}

.metric-value.small {
    font-size: 1.4rem;
    color: #4CAF50;
}

.metric-side {
    font-size: 0.75rem;
    color: #888;
    margin-top: 4px;
}

.metric-status {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.95rem;
    font-weight: 500;
    color: #ffc107;
}

.metric-status i {
    font-size: 1.2rem;
}

.metric-status.valid {
    color: #4CAF50;
}

.metric-status.invalid {
    color: #f39c12;
}

/* ============================================================
   üìà GR√ÅFICO Y LISTAS
   ============================================================ */

.rom-chart-container {
    height: 180px;
    position: relative;
}

.instructions-list {
    padding: 12px 12px 12px 28px;
    margin: 0;
    color: #bbb;
    font-size: 0.85rem;
    list-style-position: outside;
}

.instructions-list li {
    margin-bottom: 8px;
    line-height: 1.5;
}

.instructions-list li:last-child {
    margin-bottom: 0;
}

.range-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.range-list li {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    color: #ccc;
    font-size: 0.9rem;
}

.range-list li:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.range-label {
    color: #999;
}

.range-value {
    font-weight: 600;
    color: #4CAF50;
}

/* ============================================================
   üè• CLASIFICACI√ìN ROM
   ============================================================ */

.rom-classification-card {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.rom-normal-range {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
    border-radius: 6px;
    padding: 10px;
    border: 1px solid rgba(102, 126, 234, 0.3);
}

.range-header {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #e0e0e0;
    font-size: 0.9rem;
}

.range-header i {
    color: #667eea;
}

.range-header strong {
    color: #00d4ff;
}

.classification-scale {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.classification-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 4px;
    transition: background 0.2s;
}

.classification-item:hover {
    background: rgba(255, 255, 255, 0.06);
}

.classification-level {
    font-weight: 600;
    font-size: 0.8rem;
    text-transform: capitalize;
}

.classification-range {
    font-size: 0.75rem;
    color: #bbb;
}

.classification-range .percentage {
    color: #888;
    font-size: 0.7rem;
}

.clinical-note {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 10px;
    background: rgba(255, 193, 7, 0.1);
    border-radius: 6px;
    border: 1px solid rgba(255, 193, 7, 0.2);
    font-size: 0.8rem;
    color: #ccc;
    line-height: 1.4;
}

.clinical-note i {
    color: #ffc107;
    flex-shrink: 0;
    margin-top: 2px;
}

.bibliography-ref {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 10px;
    background: rgba(33, 150, 243, 0.08);
    border-radius: 6px;
    border: 1px solid rgba(33, 150, 243, 0.2);
    font-size: 0.75rem;
    color: #aaa;
}

.bibliography-ref i {
    color: #2196F3;
}

.bibliography-ref span {
    display: flex;
    align-items: center;
    gap: 6px;
}

.bibliography-ref .source {
    font-size: 0.7rem;
    color: #777;
    font-style: italic;
    padding-left: 20px;
}

/* ============================================================
   üìú HISTORIAL RECIENTE
   ============================================================ */

#recentHistoryPanel {
    max-height: 280px;
    display: flex;
    flex-direction: column;
}

.history-list {
    max-height: 220px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(102, 126, 234, 0.5) rgba(255,255,255,0.05);
}

.history-list::-webkit-scrollbar {
    width: 8px;
}

.history-list::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 4px;
}

.history-list::-webkit-scrollbar-thumb {
    background: rgba(102, 126, 234, 0.6);
    border-radius: 4px;
}

.history-list::-webkit-scrollbar-thumb:hover {
    background: rgba(102, 126, 234, 0.8);
}

.history-item {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 6px;
    padding: 8px 10px;
    margin-bottom: 6px;
    transition: background 0.2s;
}

.history-item:hover {
    background: rgba(255, 255, 255, 0.06);
}

.history-item:last-child {
    margin-bottom: 0;
}

.history-item .badge {
    font-size: 0.65rem;
    padding: 3px 6px;
}

/* ============================================================
   üì± RESPONSIVE
   ============================================================ */

/* Pantallas grandes */
@media (min-width: 1400px) {
    .main-analysis-row {
        grid-template-columns: 1fr 320px;
    }
    
    .metric-value {
        font-size: 2rem;
    }
}

/* Tablets y pantallas medianas */
@media (max-width: 1200px) {
    .main-analysis-row {
        grid-template-columns: 1fr 260px;
        gap: 15px;
    }
    
    .secondary-info-row {
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
    }
    
    .metric-value {
        font-size: 1.6rem;
    }
}

/* Pantallas medianas - mantener 2 columnas pero panel m√°s peque√±o */
@media (max-width: 991px) {
    .main-analysis-row {
        grid-template-columns: 1fr 240px;
        gap: 12px;
    }
    
    .metric-value {
        font-size: 1.5rem;
    }
    
    .metric-value.small {
        font-size: 1.1rem;
    }
    
    .secondary-info-row {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* Tablets - AQU√ç colapsa a 1 columna */
@media (max-width: 768px) {
    .main-analysis-row {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .realtime-panel {
        order: 2;
    }
    
    .video-column {
        order: 1;
    }
    
    .realtime-panel .metrics-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
    }
    
    .realtime-panel .metric-box.wide,
    .realtime-panel .metric-box.secondary {
        grid-column: span 1;
    }
    
    .secondary-info-row {
        grid-template-columns: 1fr 1fr;
    }
    
    .secondary-info-row .info-card:last-child {
        grid-column: 1 / -1;
    }
}

/* Mobile peque√±o */
@media (max-width: 576px) {
    .live-analysis-container {
        padding: 10px;
    }
    
    .exercise-header-bar {
        padding: 12px 15px;
    }
    
    .header-content {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .view-badge {
        align-self: flex-start;
    }
    
    .realtime-panel .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .secondary-info-row {
        grid-template-columns: 1fr;
    }
    
    .secondary-info-row .info-card:last-child {
        grid-column: auto;
    }
    
    .video-controls {
        padding: 12px;
        gap: 8px;
    }
    
    .video-controls .btn {
        flex: 1 1 calc(50% - 4px);
        justify-content: center;
        padding: 10px 8px;
        font-size: 0.85rem;
    }
    
    .video-controls .btn i {
        font-size: 1rem;
    }
    
    .video-controls .btn:last-child {
        flex: 1 1 100%;
    }
    
    .metrics-grid {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .metric-box {
        padding: 12px 8px;
    }
    
    .metric-value {
        font-size: 1.5rem;
    }
    
    .info-card {
        padding: 14px;
    }
}

/* ============================================================
   üñ•Ô∏è PANTALLA COMPLETA
   ============================================================ */

.video-wrapper:fullscreen,
.video-wrapper:-webkit-full-screen {
    background: #000;
    width: 100vw;
    height: 100vh;
}

.video-wrapper:fullscreen .video-stream,
.video-wrapper:-webkit-full-screen .video-stream {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

/* ============================================================
   üé® MODAL DE RESULTADOS - CON ESPECIFICIDAD FORZADA
   ============================================================ */

/* Forzar estilos del modal sobre Bootstrap */
#resultsModal .modal-content,
.modal .results-modal-content {
    background: #1a1a2e !important;
    background-color: #1a1a2e !important;
    color: white !important;
    border: 2px solid #667eea !important;
    border-radius: 16px !important;
    overflow: hidden;
}

#resultsModal .modal-header,
.modal .results-modal-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    border-bottom: none !important;
    padding: 18px 24px !important;
    color: white !important;
}

#resultsModal .modal-header .modal-title,
.results-modal-header .modal-title {
    font-weight: 600 !important;
    color: white !important;
}

#resultsModal .modal-header .btn-close {
    filter: brightness(0) invert(1) !important;
}

#resultsModal .modal-body,
.modal .results-modal-body {
    padding: 24px !important;
    background: #1a1a2e !important;
    color: white !important;
}

.results-summary {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

#resultsModal .result-item,
.results-modal-body .result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 16px;
    background: rgba(255, 255, 255, 0.08) !important;
    border-radius: 10px;
    border: 1px solid rgba(102, 126, 234, 0.2) !important;
}

#resultsModal .result-item.highlight-item,
.results-modal-body .result-item.highlight-item {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.25) 0%, rgba(118, 75, 162, 0.25) 100%) !important;
    border: 1px solid rgba(102, 126, 234, 0.5) !important;
}

#resultsModal .result-label,
.results-modal-body .result-label {
    color: rgba(255, 255, 255, 0.8) !important;
    font-weight: 500;
    font-size: 0.95rem;
}

#resultsModal .result-value,
.results-modal-body .result-value {
    font-weight: 600;
    font-size: 1rem;
    color: white !important;
}

#resultsModal .result-value.highlight,
.results-modal-body .result-value.highlight {
    color: #00d4ff !important;
    font-size: 2rem !important;
    font-weight: 700 !important;
    text-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
}

/* Estilos para resultados bilaterales */
#resultsModal .bilateral-results {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#resultsModal .bilateral-results .result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#resultsModal .bilateral-results #leftROM {
    color: #00d4ff !important;
    font-size: 1.8rem !important;
}

#resultsModal .bilateral-results #rightROM {
    color: #ff00ff !important;
    font-size: 1.8rem !important;
    text-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
}

#resultsModal .classification-badge,
.results-modal-body .classification-badge {
    background: linear-gradient(135deg, #667eea, #764ba2) !important;
    color: white !important;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
}

#resultsModal .modal-footer,
.modal .results-modal-footer {
    background: #1a1a2e !important;
    border-top: 1px solid rgba(102, 126, 234, 0.3) !important;
    padding: 16px 24px !important;
    gap: 12px;
}

#resultsModal .modal-footer .btn-outline-light {
    color: rgba(255, 255, 255, 0.8) !important;
    border-color: rgba(255, 255, 255, 0.3) !important;
}

#resultsModal .modal-footer .btn-outline-light:hover {
    background: rgba(255, 255, 255, 0.1) !important;
    color: white !important;
}

/* Z-index para modal sobre fullscreen */
#resultsModal {
    z-index: 10500 !important;
}

#resultsModal .modal-backdrop {
    z-index: 10499 !important;
}

/* Z-index para modales de selecci√≥n de pierna sobre fullscreen */
#legSelectionModal,
#continueAnalysisModal {
    z-index: 10500 !important;
}

#legSelectionModal ~ .modal-backdrop,
#continueAnalysisModal ~ .modal-backdrop {
    z-index: 10499 !important;
}

/* ============================================================
   ‚ö†Ô∏è ALERTA DE MEDICI√ìN SOSPECHOSA
   Estilo especial para advertencias de posibles errores
   ============================================================ */
#suspiciousAlert {
    background: rgba(255, 193, 7, 0.15) !important;
    border: 1px solid rgba(255, 193, 7, 0.4) !important;
    border-radius: 8px;
    color: #ffc107 !important;
}

#suspiciousAlert.alert-danger {
    background: rgba(220, 53, 69, 0.15) !important;
    border: 1px solid rgba(220, 53, 69, 0.4) !important;
    color: #dc3545 !important;
}

#suspiciousAlert .alert-heading {
    color: inherit !important;
}

#suspiciousAlert p {
    color: rgba(255, 255, 255, 0.85) !important;
}

#suspiciousAlert .text-muted {
    color: rgba(255, 255, 255, 0.6) !important;
}

/* ============================================================
   ü¶µ MODAL DE SELECCI√ìN DE PIERNA (Hip Abduction)
   ============================================================ */

.leg-selection-modal-content,
.continue-modal-content {
    background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
    border: 1px solid rgba(0, 212, 255, 0.3);
    border-radius: 16px;
}

.leg-selection-header,
.continue-modal-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-bottom: 1px solid rgba(0, 212, 255, 0.3);
    border-radius: 15px 15px 0 0;
}

.leg-selection-header .modal-title,
.continue-modal-header .modal-title {
    color: white;
    font-weight: 600;
}

.leg-selection-body,
.continue-modal-body {
    padding: 25px;
    color: #e0e0e0;
}

.leg-buttons-container {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 20px;
}

.btn-leg {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 150px;
    height: 150px;
    border-radius: 16px;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.btn-leg-left {
    background: linear-gradient(145deg, #00d4ff, #0099cc);
    color: #000;
}

.btn-leg-left:hover {
    background: linear-gradient(145deg, #00e5ff, #00b8e6);
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
}

.btn-leg-right {
    background: linear-gradient(145deg, #ff00ff, #cc00cc);
    color: #fff;
}

.btn-leg-right:hover {
    background: linear-gradient(145deg, #ff33ff, #e600e6);
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
}

.leg-label {
    font-size: 0.95rem;
    font-weight: 600;
    margin-top: 5px;
}

/* Modal de continuaci√≥n */
.first-leg-result {
    text-align: center;
    padding: 20px;
    background: rgba(0, 212, 255, 0.1);
    border-radius: 12px;
    border: 1px solid rgba(0, 212, 255, 0.2);
}

.result-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.text-biomech-cyan {
    color: #00d4ff !important;
}
</style>
{% endblock %}

{% block scripts %}
<!-- Chart.js para gr√°ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- VPS Camera Handler para modo WebRTC -->
<script src="{{ url_for('static', filename='js/vps_camera_handler.js') }}?v=1.6"></script>

<!-- Configuraci√≥n del ejercicio -->
<script>
    const EXERCISE_CONFIG = {
        segment_type: "{{ segment_type }}",
        exercise_key: "{{ exercise_key }}",
        exercise_name: "{{ exercise_name }}",
        camera_view: "{{ camera_view }}",
        min_angle: {{ min_angle }},
        max_angle: {{ max_angle }},
        back_url: "{{ url_for('main.segment_exercises', segment_type=segment_type) }}"
    };
</script>

<!-- Script principal de an√°lisis -->
<script src="{{ url_for('static', filename='js/live_analysis.js') }}?v=3.8"></script>
{% endblock %}
